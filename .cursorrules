# Next.js App Router Project Structure Rules

## Project Organization

### Directory Structure
- Use the App Router (`app/` directory) for all routing
- Organize components in `src/components/` with subdirectories by feature
- Keep utilities in `src/lib/` or `src/utils/`
- Store types in `src/types/` or co-locate with components
- Place constants in `src/constants/`
- Store hooks in `src/hooks/`

### File Naming Conventions
- Use kebab-case for directories: `product-cards/`, `user-profile/`
- Use PascalCase for component files: `ProductCard.tsx`, `UserProfile.tsx`
- Use camelCase for utility files: `formatDate.ts`, `apiClient.ts`
- Use UPPER_SNAKE_CASE for constants: `API_ENDPOINTS.ts`

## App Directory Structure

### Core Files
```
app/
├── layout.tsx          # Root layout (required)
├── page.tsx           # Home page
├── globals.css        # Global styles
├── favicon.ico        # Favicon
└── [dynamic]/         # Dynamic routes
    └── page.tsx
```

### Layout Patterns
- Use `layout.tsx` for shared UI across routes
- Keep layouts minimal and focused on structure
- Use `template.tsx` for layouts that need to re-render on navigation
- Use `loading.tsx` for loading states
- Use `error.tsx` for error boundaries
- Use `not-found.tsx` for 404 pages

## Component Organization

### Component Structure
```
src/
├── components/
│   ├── ui/            # Reusable UI components
│   │   ├── Button.tsx
│   │   ├── Card.tsx
│   │   └── index.ts
│   ├── layout/        # Layout components
│   │   ├── Header.tsx
│   │   ├── Footer.tsx
│   │   └── Sidebar.tsx
│   ├── forms/         # Form components
│   │   ├── ContactForm.tsx
│   │   └── SearchForm.tsx
│   └── features/      # Feature-specific components
│       ├── products/
│       │   ├── ProductCard.tsx
│       │   ├── ProductGrid.tsx
│       │   └── ProductDetails.tsx
│       └── auth/
│           ├── LoginForm.tsx
│           └── SignupForm.tsx
```

### Component Guidelines
- Use Server Components by default
- Use Client Components only when necessary (interactivity, hooks, browser APIs)
- Add `"use client"` directive at the top of Client Components
- Keep components focused and single-purpose
- Use TypeScript for all components
- Export components as named exports, not default exports

## Styling Guidelines

### CSS Organization
- Use Tailwind CSS for utility-first styling
- Use CSS Modules for component-specific styles
- Use global CSS sparingly (only in `app/globals.css`)
- Use CSS-in-JS only when necessary

### Tailwind Configuration
- Extend theme in `tailwind.config.js`
- Use custom CSS variables for design tokens
- Configure content paths to include all component directories

## Data Fetching

### Server Components
- Use async/await in Server Components for data fetching
- Use `fetch()` with caching strategies
- Implement proper error handling
- Use React Suspense for loading states

### API Routes
- Place API routes in `app/api/`
- Use Route Handlers for API endpoints
- Implement proper error handling and validation
- Use TypeScript for API route types

## State Management

### Client State
- Use React hooks for local state
- Use Zustand or Jotai for global state
- Avoid Redux for simple applications
- Use React Query for server state

### Server State
- Use Server Components for initial data
- Implement proper caching strategies
- Use revalidation for data updates

## Performance Guidelines

### Optimization
- Use Next.js Image component for images
- Implement proper loading strategies
- Use dynamic imports for code splitting
- Optimize fonts with `next/font`
- Use React.memo() sparingly

### Caching
- Implement proper caching headers
- Use Next.js built-in caching mechanisms
- Cache expensive computations
- Use ISR for static pages with dynamic data

## TypeScript Guidelines

### Type Organization
```
src/
├── types/
│   ├── api.ts         # API response types
│   ├── components.ts  # Component prop types
│   ├── global.ts      # Global types
│   └── index.ts       # Type exports
```

### Type Guidelines
- Use interfaces for object shapes
- Use types for unions and intersections
- Export types from dedicated type files
- Use generic types for reusable components
- Implement proper error types

## Testing Structure

### Test Organization
```
src/
├── __tests__/         # Test files
│   ├── components/
│   ├── utils/
│   └── pages/
├── __mocks__/         # Mock files
└── test-utils/        # Test utilities
```

### Testing Guidelines
- Use Jest and React Testing Library
- Test components in isolation
- Mock external dependencies
- Test user interactions, not implementation details
- Use MSW for API mocking

## Environment Configuration

### Environment Files
```
.env.local            # Local environment variables
.env.development      # Development environment
.env.production       # Production environment
.env.example          # Example environment file
```

### Configuration Guidelines
- Use environment variables for configuration
- Validate environment variables at startup
- Use TypeScript for environment variable types
- Keep sensitive data in environment variables

## Build and Deployment

### Build Configuration
- Use `next.config.js` for build configuration
- Implement proper image optimization
- Configure proper redirects and rewrites
- Use proper output configuration

### Deployment Guidelines
- Use Vercel for deployment
- Implement proper CI/CD pipelines
- Use proper environment variables in production
- Monitor performance and errors

## Code Quality

### Linting and Formatting
- Use ESLint with Next.js configuration
- Use Prettier for code formatting
- Use TypeScript strict mode
- Implement proper import sorting

### Git Guidelines
- Use conventional commits
- Implement proper branch naming
- Use pull request templates
- Implement proper code review processes

## Security Guidelines

### Security Best Practices
- Validate all user inputs
- Implement proper authentication
- Use HTTPS in production
- Implement proper CORS policies
- Sanitize data before rendering

### Authentication
- Use NextAuth.js for authentication
- Implement proper session management
- Use secure cookies
- Implement proper authorization

## Accessibility

### Accessibility Guidelines
- Use semantic HTML elements
- Implement proper ARIA attributes
- Ensure keyboard navigation
- Test with screen readers
- Follow WCAG guidelines

## Documentation

### Documentation Structure
```
docs/
├── components/        # Component documentation
├── api/              # API documentation
├── deployment/       # Deployment guides
└── README.md         # Project overview
```

### Documentation Guidelines
- Document complex components
- Use JSDoc for function documentation
- Maintain up-to-date README
- Document API endpoints
- Include setup instructions

## Migration Guidelines

### From Pages Router
- Migrate pages to app directory
- Update routing patterns
- Migrate data fetching to Server Components
- Update middleware if necessary
- Test thoroughly after migration

### From Create React App
- Follow Next.js migration guides
- Update import paths
- Migrate routing to App Router
- Update build configuration
- Test all functionality

## Performance Monitoring

### Monitoring Setup
- Use Next.js Analytics
- Implement error tracking
- Monitor Core Web Vitals
- Use performance budgets
- Monitor bundle sizes

## SEO Guidelines

### SEO Best Practices
- Use Next.js Metadata API
- Implement proper meta tags
- Use structured data
- Optimize for Core Web Vitals
- Implement proper sitemaps

## Internationalization

### i18n Setup
- Use Next.js i18n features
- Implement proper locale detection
- Use translation files
- Implement proper date/time formatting
- Use proper number formatting

## Database Integration

### Database Guidelines
- Use Prisma for database access
- Implement proper connection pooling
- Use migrations for schema changes
- Implement proper error handling
- Use transactions when necessary

## API Integration

### API Guidelines
- Use TypeScript for API types
- Implement proper error handling
- Use proper HTTP status codes
- Implement rate limiting
- Use proper authentication

## Component Patterns

### Common Patterns
- Use compound components for complex UI
- Implement proper prop drilling alternatives
- Use render props for flexible components
- Implement proper error boundaries
- Use proper loading states

## State Patterns

### State Management Patterns
- Use React Context for theme/global state
- Implement proper reducer patterns
- Use custom hooks for reusable logic
- Implement proper optimistic updates
- Use proper error state management

## File Structure Examples

### Feature-based Structure
```
src/
├── features/
│   ├── auth/
│   │   ├── components/
│   │   ├── hooks/
│   │   ├── types/
│   │   └── utils/
│   └── products/
│       ├── components/
│       ├── hooks/
│       ├── types/
│       └── utils/
```

### Atomic Design Structure
```
src/
├── components/
│   ├── atoms/
│   ├── molecules/
│   ├── organisms/
│   ├── templates/
│   └── pages/
```

## Best Practices Summary

1. **Use Server Components by default**
2. **Keep components focused and single-purpose**
3. **Use TypeScript for type safety**
4. **Implement proper error handling**
5. **Use proper loading states**
6. **Optimize for performance**
7. **Follow accessibility guidelines**
8. **Implement proper testing**
9. **Use proper environment configuration**
10. **Follow security best practices**

## Common Anti-patterns to Avoid

1. **Don't use Client Components unnecessarily**
2. **Don't prop drill deeply**
3. **Don't use global state for local state**
4. **Don't ignore error boundaries**
5. **Don't skip loading states**
6. **Don't use inline styles**
7. **Don't ignore accessibility**
8. **Don't skip testing**
9. **Don't hardcode configuration**
10. **Don't ignore security**

## Migration Checklist

- [ ] Set up proper directory structure
- [ ] Configure TypeScript
- [ ] Set up ESLint and Prettier
- [ ] Configure Tailwind CSS
- [ ] Set up testing framework
- [ ] Configure environment variables
- [ ] Set up proper routing
- [ ] Implement error boundaries
- [ ] Set up proper loading states
- [ ] Configure build optimization
- [ ] Set up deployment pipeline
- [ ] Implement monitoring
- [ ] Set up documentation
- [ ] Configure accessibility testing
- [ ] Set up performance monitoring 